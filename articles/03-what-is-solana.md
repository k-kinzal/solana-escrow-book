# 3. エスクローを作るための前提知識

本章ではSolanaブロックチェーンでエスクローを作るために前提となる知識を紹介します。

## 3.1. Solanaブロックチェーン

Solanaはブロックチェーンの一種で高いトランザクション処理能力と低い手数料が特徴のチェーンです。
その特徴から分散型アプリケーション（DApps）の開発に向いています。

私はよくSolanaブロックチェーンを説明するさいにデータベースに例えて説明します。

Solanaブロックチェーンでは1つの公開されたデータベース/テーブルを全員で共有していると考えてください。
このテーブルに含まれるレコードに相当するものがSolanaブロックチェーンで**アカウント**と呼ばれます。

このアカウントを作成、変更、破棄は**プログラム**と呼ばれるストアドプロシージャのようなものからのみ行われます。

Solanaブロックチェーンを利用するユーザーは、このプログラムを呼び出す**インストラクション**を束ねた**トランザクション**をSolanaネットワークに送信することでアカウントの更新を行います。

![](images/03-what-is-solana-001.jpg)

ユーザーの送信したトランザクションで成功したトランザクションは全て記録されます。
データベースで言うREDOログやバイナリログのようなものですね。

ざっくりとした説明にはなりますが、SolanaでDAppsを作るならこのぐらいの理解で大丈夫です。
もし、より詳細なSolanaブロックチェーンの仕組みを知りたい方は公式のドキュメントを参照してください。

## 3.2. アカウント

アカウントは先ほど説明した通りSolanaブロックチェーン上でデータを保持するものを指します。
このアカウントはアドレス、メタ情報、データの3つの要素から成り立ちます。

![](images/03-what-is-solana-002.jpg)

### アドレス

アドレスははSolanaブロックチェーン上で一意な値になります。
このアドレスの値を元にアカウントの読み書きを行うため、データベースで言うプライマリキーのような働きをします。

### メタ情報

メタ情報としてどういったアカウントなのかを示す情報を持ちます。
いくつか、エスクローで知っておくべきメタ情報を紹介します。

`lamports`はアカウントが保有するSOLトークンの量です。
LamportはSOLの最小単位であり `1 lamports` = `0.000000001 SOL` に相当します。

この`lamports`に割り当てたSOLは家賃（Rent）として一定周期で引き落とされます。
引き落としする量はアカウントのデータサイズによって変動します。
もし、`lamports`が`0`になったらそのアカウントは破棄されます。
そのため意図的にアカウントを破棄したい場合は`lamports`を`0`にすることで実現できます。

しかし実際に全てのアカウントで`lamports`を維持し続けるのは現実的ではありません。
Solanaブロックチェーンではアカウントを維持し続けるために、一定のLamportを事前に預けることで家賃を免除することができます。
家賃免除に必要なLamportはRPCのメソッドの`getMinimumBalanceForRentExemption`を呼び出すことで取得できます。

`owner`はアカウントを所有しているプログラムのアドレスです。
先に説明したとおりアカウントを操作できるのはこの`owner`のプログラムからのみです。

これ以外にも`rent_epoch`や`executable`なども存在しますがそちらに関してはエスクローでは利用しないため、詳しく知りたい方はSolanaの公式ドキュメントを参照ください。

### データ

データはアカウントが保持する状態です。
設定するデータの形式は特に指定はなくバイトデータとして自由に設定することができます。
よく見かける形式としてはCのメモリレイアウト、Borsh形式などが見られます。

この`data`には最大10MBまで設定することができます。

## 3.3. プログラム

プログラムは

## 3.4. インストラクション

## 3.5. トランザクション

## 3.6. RPCエンドポイント

## Program Derived Address

## Cross Program Invocation
